<!--
TEMPLATE MAP (reference-only)
.claude/templates/docs/08-task/active/micro-spec.md

OUTPUT MAP (write to)
agent-docs/08-task/active/F-004.md

NOTES
- Micro-spec for F-004 implementation
- 5 tasks total
- Target: v1.1.1
-->

# F-004: DDL Syntax Highlight & Copy Button - Implementation Tasks

## 0) Meta

- **Feature**: F-004
- **Title**: DDL Syntax Highlight & Copy Button
- **Target Release**: v1.1.1
- **Status**: In Progress
- **Created**: 2026-01-14
- **Dependencies**: F-003 (Schema Panel Enhancement) - DONE

## 1) Task Catalog

### Task F-004.1: Install Dependencies

**Description**: Install `react-syntax-highlighter` and its TypeScript types

**Owner**: S8:worker

**Acceptance Criteria**:
- [ ] `react-syntax-highlighter` added to `package.json` dependencies
- [ ] `@types/react-syntax-highlighter` added to `package.json` devDependencies
- [ ] `npm install` completes without errors
- [ ] Build still passes

**Implementation Notes**:
```bash
npm install react-syntax-highlighter @types/react-syntax-highlighter
```

**Estimated Complexity**: Low (5 min)

---

### Task F-004.2: Update SchemaDDLView Component with State

**Description**: Add state management for copy functionality to SchemaDDLView component

**Owner**: S8:worker

**Acceptance Criteria**:
- [ ] `copied` state added (boolean, default: false)
- [ ] `error` state added (string | null, default: null)
- [ ] State hooks properly typed
- [ ] Component renders without errors

**Implementation Notes**:

```typescript
// src/devtools/components/TablesTab/SchemaDDLView.tsx

import { useState } from "react";

export const SchemaDDLView = ({ ddl }: SchemaDDLViewProps) => {
  const [copied, setCopied] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // ... rest of component
};
```

**Estimated Complexity**: Low (10 min)

---

### Task F-004.3: Implement Copy Button with Clipboard API

**Description**: Add copy button with icon switching and error handling

**Owner**: S8:worker

**Acceptance Criteria**:
- [ ] Copy button visible in DDL header (right aligned)
- [ ] Default icon: `MdOutlineContentCopy`
- [ ] Success icon: `FaCheck` (green)
- [ ] Clicking copy calls `navigator.clipboard.writeText(ddl)`
- [ ] Success: Icon changes to checkmark
- [ ] Error: Inline error message shows
- [ ] Clicking again resets to copy icon and copies again

**Implementation Notes**:

```typescript
import { MdOutlineContentCopy } from "react-icons/md";
import { FaCheck } from "react-icons/fa";

const handleCopy = async () => {
  try {
    await navigator.clipboard.writeText(ddl);
    setCopied(true);
    setError(null);
  } catch (err) {
    setError("Failed to copy");
    setCopied(false);
  }
};

const handleClick = () => {
  if (copied) {
    setCopied(false);
  } else {
    handleCopy();
  }
};

// In render:
<div className="flex items-center justify-between mb-2">
  <div className="flex-1" />
  <button
    onClick={handleClick}
    className="p-1 text-gray-600 hover:text-gray-800 transition-colors"
    title={copied ? "Copied!" : "Copy DDL"}
  >
    {copied ? (
      <FaCheck className="text-green-600" size={14} />
    ) : (
      <MdOutlineContentCopy size={14} />
    )}
  </button>
</div>

{error && (
  <div className="text-red-600 text-xs mb-2 text-right">{error}</div>
)}
```

**Estimated Complexity**: Medium (20 min)

---

### Task F-004.4: Implement Syntax Highlighting

**Description**: Replace plain `<pre>` with `SyntaxHighlighter` component using Prism.js

**Owner**: S8:worker

**Acceptance Criteria**:
- [ ] Import `Prism as SyntaxHighlighter` and `prism` style
- [ ] DDL rendered with SQL syntax highlighting
- [ ] Light theme applied (gray-50 background)
- [ ] Font size: 12px (text-xs)
- [ ] Rounded corners: 6px
- [ ] Code properly formatted with whitespace preserved

**Implementation Notes**:

```typescript
import { Prism as SyntaxHighlighter } from "react-syntax-highlighter";
import { prism } from "react-syntax-highlighter/dist/esm/styles/prism";

// Replace old <pre> block with:
<SyntaxHighlighter
  language="sql"
  style={prism}
  customStyle={{
    background: '#f9fafb',    // gray-50
    padding: '12px',
    borderRadius: '6px',
    fontSize: '12px',         // text-xs
  }}
>
  {ddl || "-- No DDL available --"}
</SyntaxHighlighter>
```

**Estimated Complexity**: Low (10 min)

---

### Task F-004.5: Build, Test, and Commit

**Description**: Build the project, test functionality, and commit changes

**Owner**: S8:worker

**Acceptance Criteria**:
- [ ] Build passes without errors: `npm run build`
- [ ] Extension loads in Chrome DevTools
- [ ] DDL is syntax highlighted (light theme)
- [ ] Copy button visible and clickable
- [ ] Copy to clipboard works
- [ ] Green checkmark appears after copy
- [ ] Checkmark resets on next click
- [ ] Error handling tested (disable clipboard API)
- [ ] Bundle size increase < 50KB
- [ ] Changes committed with proper message

**Test Plan**:
1. Open DevTools panel for a database
2. Navigate to a table detail view
3. Click DDL tab in schema panel
4. Verify DDL is syntax highlighted (colored keywords)
5. Click copy button
6. Paste to verify clipboard works
7. Verify green checkmark appears
8. Click button again to reset
9. Test error case (if possible)

**Estimated Complexity**: Low (15 min)

---

## 2) Component Files Modified

| File | Changes |
| ---- | ------- |
| `package.json` | Add react-syntax-highlighter dependencies |
| `src/devtools/components/TablesTab/SchemaDDLView.tsx` | Add state, copy button, syntax highlighter |

## 3) Dependencies Added

```json
{
  "dependencies": {
    "react-syntax-highlighter": "^15.5.0"
  },
  "devDependencies": {
    "@types/react-syntax-highlighter": "^15.5.0"
  }
}
```

## 4) Bundle Impact

- **Expected increase**: ~18.8KB (Prism.js variant)
- **Total impact**: < 50KB after tree-shaking
- **Current build size**: ~1.2MB
- **New build size**: ~1.25MB (well under 2MB limit)

## 5) Rollback Plan

If issues arise:
1. Revert `SchemaDDLView.tsx` to previous version
2. Remove react-syntax-highlighter from `package.json`
3. Run `npm install` to clean dependencies
4. Rebuild extension

## 6) Definition of Done

- [ ] All 5 tasks completed
- [ ] All acceptance criteria met
- [ ] Build passes without errors
- [ ] Manual testing complete
- [ ] Changes committed
- [ ] Status board updated
- [ ] Roadmap marked complete

## 7) Progress Tracking

| Task ID | Status | Completed |
| ------- | ------ | --------- |
| F-004.1 | Pending | |
| F-004.2 | Pending | |
| F-004.3 | Pending | |
| F-004.4 | Pending | |
| F-004.5 | Pending | |

**Overall Progress**: 0/5 tasks (0%)
