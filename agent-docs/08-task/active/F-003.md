<!--
TEMPLATE MAP (reference-only)
.claude/templates/docs/08-task/micro-spec.md

OUTPUT MAP (write to)
agent-docs/08-task/active/F-003.md

NOTES
- Feature F-003: Schema Panel Enhancement
- Toggle visibility and tabbed view (Table/DDL)
-->

# F-003: Schema Panel Enhancement

## Task Meta

- **Task ID**: F-003
- **Title**: Schema Panel Enhancement - Toggle & Tabbed View
- **Status**: Ready for Implementation
- **Priority**: P1 (High)
- **Estimated Complexity**: Medium
- **Dependencies**: F-002 (Database Tab Navigation)
- **Feature Spec**: [F-003: Schema Panel Enhancement](agent-docs/01-discovery/features/F-003-schema-panel-enhancement.md)

## Problem Statement

The current schema panel has UX limitations:

1. Fixed 320px width wastes horizontal space
2. Shows both table schema AND DDL simultaneously
3. No toggle visibility option
4. "SCHEMA" title consumes vertical space

## Solution Overview

Add toggle visibility (hidden by default) and tabbed view (Table/DDL) to the schema panel with:

- Toggle button with `BsReverseLayoutSidebarInsetReverse` icon
- Two tab buttons: Table icon (`ImTable2`) + DDL text
- Emerald theme active states (emerald-50 background, emerald-600 text)
- Responsive width: 320px when visible, 0px when hidden
- Smooth CSS transition (200ms)

## Implementation Tasks

### Task 1: Create SchemaPanel Sub-Components

**Files to Create**:

- `src/devtools/components/TablesTab/SchemaPanelHeader.tsx`
- `src/devtools/components/TablesTab/SchemaTableView.tsx`
- `src/devtools/components/TablesTab/SchemaDDLView.tsx`
- `src/devtools/components/TablesTab/SchemaLoadingSkeleton.tsx`
- `src/devtools/components/TablesTab/SchemaErrorMessage.tsx`

**Acceptance Criteria**:

- [ ] SchemaPanelHeader renders toggle button (left) + tab buttons (right)
- [ ] Toggle button uses `BsReverseLayoutSidebarInsetReverse` icon
- [ ] Table tab button uses `ImTable2` icon
- [ ] DDL tab button uses "DDL" text
- [ ] Active tab shows emerald-50 background, emerald-600 text, emerald-200 border
- [ ] Inactive tab shows gray-500 text, gray-200 border
- [ ] Buttons are text-xs size (~12px font)
- [ ] SchemaTableView removes "SCHEMA" title
- [ ] SchemaDDLView removes "DDL" sub-heading
- [ ] Build passes with no errors

### Task 2: Refactor SchemaPanel Component

**File to Modify**:

- `src/devtools/components/TablesTab/TableSchema.tsx` â†’ Rename to `SchemaPanel.tsx`

**Changes**:

1. Rename component from `TableSchemaPanel` to `SchemaPanel`
2. Add new props interface:
   ```typescript
   interface SchemaPanelProps {
     schema: TableSchema | null;
     loading?: boolean;
     error?: string | null;
     visible: boolean;
     activeTab: "table" | "ddl";
     onToggle: () => void;
     onTabChange: (tab: "table" | "ddl") => void;
   }
   ```
3. Add CSS transition classes:
   ```typescript
   const panelClasses = `
     transition-all duration-200 ease-in-out
     ${visible ? "w-80 opacity-100" : "w-0 opacity-0 overflow-hidden"}
     bg-gray-50 border-l border-gray-200
   `;
   ```
4. Import sub-components
5. Render header + conditional content based on activeTab

**Acceptance Criteria**:

- [ ] Component renamed to `SchemaPanel`
- [ ] New props interface matches specification
- [ ] CSS classes provide smooth 200ms transition
- [ ] Panel width transitions from w-80 to w-0
- [ ] Opacity transitions from 100 to 0
- [ ] Overflow hidden when collapsed
- [ ] Header renders with toggle + tabs
- [ ] Content switches based on activeTab
- [ ] Loading state shows skeleton
- [ ] Error state shows error message
- [ ] Build passes with no errors

### Task 3: Update TableDetail Component

**File to Modify**:

- `src/devtools/components/TablesTab/TableDetail.tsx`

**Changes**:

1. Add state for schema panel:

   ```typescript
   const [schemaPanelVisible, setSchemaPanelVisible] = useState(false);
   const [schemaTab, setSchemaTab] = useState<"table" | "ddl">("table");
   ```

2. Add handler functions:

   ```typescript
   const handleToggleSchema = useCallback(() => {
     setSchemaPanelVisible((prev) => !prev);
   }, []);

   const handleSchemaTabChange = useCallback((tab: "table" | "ddl") => {
     setSchemaTab(tab);
   }, []);
   ```

3. Update import from `TableSchema` to `SchemaPanel`
4. Update props passed to SchemaPanel
5. Update table data panel className for responsive width

**Acceptance Criteria**:

- [ ] State initialized: schemaPanelVisible = false (hidden by default)
- [ ] State initialized: schemaTab = 'table' (default to table view)
- [ ] Handler functions use useCallback
- [ ] SchemaPanel props include visible, activeTab, onToggle, onTabChange
- [ ] Table data panel className: `schemaPanelVisible ? 'flex-1' : 'w-full'`
- [ ] Table data panel has transition classes
- [ ] No horizontal overflow when toggling
- [ ] Build passes with no errors

### Task 4: Update Icon Imports

**File to Modify**:

- No changes needed (react-icons already installed)

**Verification**:

- [ ] `react-icons` version in package.json: ^5.5.0
- [ ] Icons can be imported:
  ```typescript
  import { BsReverseLayoutSidebarInsetReverse } from "react-icons/bs";
  import { ImTable2 } from "react-icons/im";
  ```

### Task 5: Testing & Verification

**Manual Testing Checklist**:

- [ ] Panel hidden by default when page loads
- [ ] Toggle button shows/hides panel
- [ ] Table data expands to full width when panel hidden
- [ ] Transition is smooth (200ms)
- [ ] Clicking table tab shows column info table
- [ ] Clicking DDL tab shows SQL CREATE TABLE statement
- [ ] Active tab styling correct (emerald theme)
- [ ] Inactive tab styling correct (gray theme)
- [ ] "SCHEMA" title removed
- [ ] "DDL" sub-heading removed
- [ ] Works across different table selections
- [ ] No console errors
- [ ] TypeScript compilation passes

## Definitions of Done

### Code Quality

- [ ] All TypeScript types are strictly defined
- [ ] No `any` types used (except where explicitly needed)
- [ ] Components use functional patterns with hooks
- [ ] Props interfaces exported for reuse
- [ ] TSDoc comments added to component interfaces

### Styling

- [ ] Tailwind CSS classes used consistently
- [ ] Emerald theme colors from index.css
- [ ] Button sizes match pagination style (text-xs)
- [ ] Transitions are smooth (200ms)
- [ ] No layout shift during animations

### Testing

- [ ] Manual testing complete per checklist
- [ ] Build passes with no errors
- [ ] No console warnings or errors
- [ ] All acceptance criteria met

### Documentation

- [ ] HLD updated (section 9 added)
- [ ] LLD updated (section 8-10 added)
- [ ] Task catalog updated (F-003 added)
- [ ] Status board updated

## Implementation Notes

### CSS Transition Strategy

Use Tailwind's transition utilities:

```tsx
// Panel container
<div className={`
  transition-all duration-200 ease-in-out
  ${visible ? 'w-80 opacity-100' : 'w-0 opacity-0 overflow-hidden'}
  bg-gray-50 border-l border-gray-200
`}>

// Table data panel
<div className={`
  transition-all duration-200 ease-in-out
  ${schemaPanelVisible ? 'flex-1' : 'w-full'}
`}>
```

### State Reset Behavior

Per F-003 spec, panel state resets when switching tables:

- `schemaPanelVisible` resets to `false` on table change
- `schemaTab` resets to `'table'` on table change

This is achieved by using `useState` with default values - no persistence needed.

### Icon Package Verification

`react-icons` is already installed (package.json line: `"react-icons": "^5.5.0"`).

No additional package installation required.

## Related Files

- Feature Spec: `agent-docs/01-discovery/features/F-003-schema-panel-enhancement.md`
- HLD: `agent-docs/03-architecture/01-hld.md` (section 9)
- LLD: `agent-docs/05-design/03-modules/devtools-panel.md` (section 8-10)
- Task Catalog: `agent-docs/07-taskManager/02-task-catalog.md` (F-003 entry)

## Success Criteria

1. **Toggle Functionality**
   - Toggle button visible in schema panel header
   - Clicking toggle shows/hides panel
   - Table data expands to full width when hidden
   - Panel is hidden by default on mount
   - Smooth transition animation (200ms)

2. **Tab Controls**
   - Two tab buttons in header: Table icon + DDL text
   - "SCHEMA" title removed
   - Active tab shows emerald-50 background
   - Inactive tab shows gray-500 text
   - Clicking tab switches content view

3. **Table View**
   - Shows column info table when "Table" tab active
   - Columns: name, type, constraints
   - PK/NOT NULL/DEFAULT badges visible

4. **DDL View**
   - Shows CREATE TABLE statement when "DDL" tab active
   - Dark background with green text
   - "DDL" sub-heading removed
   - Code block scrollable horizontally

5. **Responsive Behavior**
   - No horizontal overflow when toggling
   - Table data width adjusts smoothly
   - Tab state persists across toggle

6. **Icons & Styling**
   - `BsReverseLayoutSidebarInsetReverse` icon visible
   - `ImTable2` icon visible on table tab
   - Button size: text-xs (~12px font)
   - Emerald theme colors applied correctly
